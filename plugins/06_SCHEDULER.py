"""
тП░ SCHEDULER PLUGIN
Time-based messages
"""

import time
from datetime import datetime

schedule_messages = {
    6: "тП░ рзмржЯрж╛: ржмрж╛ржЪрзНржЪрж╛рж░рж╛ ржШрзБржо ржерзЗржХрзЗ ржЙржа ржмрзНрж░рж╛рж╢ ржХрж░ рж╣рж╛рждржорзБржЦ ржзрзЛржУ",
    8: "ЁЯН╜я╕П рзоржЯрж╛: ржХрзНрж╖рзБржзрж╛ рж▓рж╛ржЧржЫрзЗ рждрж╛ржбрж╝рж╛рждрж╛ржбрж╝рж┐ ржЦрж╛ржмрж╛рж░ ржЦрж╛ржУ ЁЯР╗тАНтЭДя╕П",
    10: "ЁЯТ╝ рззрзжржЯрж╛: ржХрж╛ржЬрзЗрж░ рж╕ржоржпрж╝ рж╣ржпрж╝рзЗржЫрзЗ ржХрж╛ржЬрзЗ ржпрж╛ржУ ЁЯТЭ / ржмрж╛ржЪрзНржЪрж╛ржжрзЗрж░ рж╕рзНржХрзБрж▓ ржЯрж╛ржЗржо рж╕рзНржХрзБрж▓рзЗ ржпрж╛ржУ",
    11: "ЁЯЫБ рззрззржЯрж╛: рж╕рзНржХрзБрж▓ ржЫрзБржЯрж┐рж░ ржЯрж╛ржЗржо ржкрзНрж░рж╛ржпрж╝ ЁЯла / ржЖржЧрзЗ ржЖржЧрзЗ ржЧрзЛрж╕рж▓ ржХрж░рж╛ ржнрж╛рж▓рзЛ рж╢рж░рзАрж░ ржнрж╛рж▓рзЛ ржерж╛ржХрзЗ ржЧрзЛрж╕рж▓ ржХрж░рзЗ ржирж╛ржУ ЁЯШГ",
    12: "ЁЯОТ рззрзиржЯрж╛: рж▓рзБржЪрзНржЪрж╛ ржмржирзНржзрзБ ржЧрж╛рж░рзНрж▓рж╕ рж╕рзНржХрзБрж▓ ржЫрзБржЯрж┐ рж╣ржпрж╝рзЗржЫрзЗ рж░рзЗ / ржжрзБржкрзБрж░ рж╣ржпрж╝рзЗ ржЧрзЗржЫрзЗ рж╕ржмрж╛ржЗ рждрж╛ржбрж╝рж╛рждрж╛ржбрж╝рж┐ ржЧрзЛрж╕рж▓ ржХрж░",
    13: "ЁЯЫБ рззржЯрж╛: ржПржЦржирзЛ ржЧрзЛрж╕рж▓ ржХрж░рзЛ ржирж╛ржЗ рждрж╛ржбрж╝рж╛рждрж╛ржбрж╝рж┐ ржЧрзЛрж╕рж▓ ржХрж░ ржПржХржЯрзБ ржкрж░ ржЖржЬрж╛ржи ржжрзЗржмрзЗржи ржирж╛ржорж╛ржЬ ржкржбрж╝рждрзЗ ржпрж╛ржЗрждрзЗ рж╣ржмрзЗ рждрзЛ",
    14: "ЁЯНЪ рзиржЯрж╛: ржЦрж┐ржжрж╛ рж▓рж╛ржЧржЫрзЗ рждрж╛ржбрж╝рж╛рждрж╛ржбрж╝рж┐ ржЦрж╛ржмрж╛рж░ ржЦрж╛ржУ",
    15: "ЁЯШ┤ рзйржЯрж╛: ржПржЦржи ржжрзБржкрзБрж░ ржПржмржВ ржмрж┐ржХрзЗрж▓рзЗрж░ ржорж╛ржЭрж╛ржорж╛ржЭрж┐ рж╕ржоржпрж╝ ржПржХржЯрзБ ржШрзБржорж┐ржпрж╝рзЗ ржирж╛ржУ рж╢рж░рзАрж░ржЯрж╛ ржнрж╛рж▓рзЛ ржерж╛ржХржмрзЗ",
    16: "тЪ╜ рзкржЯрж╛: ржПржЦржи ржЦрзЗрж▓рж╛рж░ рж╕ржоржпрж╝ ржЦрзЗрж▓рждрзЗ ржпрж╛ржУ рждржмрзЗ ржирж╛ржорж╛ржЬрзЗрж░ ржХржерж╛ ржоржирзЗ рж░рж╛ржЗржЦрзЛ",
    18: "ЁЯСитАНЁЯСйтАНЁЯСзтАНЁЯСж рзмржЯрж╛: ржлрзНржпрж╛ржорж┐рж▓рж┐ржХрзЗ рж╕ржоржпрж╝ ржжрж╛ржУ ржмрж╛ржмрж╛-ржорж╛-ржнрж╛ржЗ-ржмрзЛржирзЗрж░ рж╕рж╛ржерзЗ рж╕ржоржпрж╝ ржХрж╛ржЯрж╛ржУ ржкрзНрж░рж┐ржпрж╝ ржорж╛ржирзБрж╖ржжрзЗрж░ рж╕рж╛ржерзЗ ржХржерж╛ ржмрж▓",
    19: "ЁЯУЪ рзнржЯрж╛: ржкржбрж╝рж╛рж░ рж╕ржоржпрж╝ рж╣ржпрж╝рзЗржЫрзЗ рждрж╛ржбрж╝рж╛рждрж╛ржбрж╝рж┐ ржкржбрж╝рждрзЗ ржмрж╕рзЛ",
    20: "ЁЯН╜я╕П рзоржЯрж╛: ржЦрж┐ржжрж╛ рж▓рж╛ржЧржЫрзЗ рждрж╛ржбрж╝рж╛рждрж╛ржбрж╝рж┐ ржЦрж╛ржмрж╛рж░ ржЦрж╛ржУ ржкрзНрж░ржЪрзБрж░ ржЦрж┐ржжрж╛ рж▓рж╛ржЧржЫрзЗ ржШрзБржорж╛ржЗрждрзЗ рж╣ржмрзЗ рждрзЛ",
    21: "ЁЯШ┤ рзпржЯрж╛: рждрж╛ржбрж╝рж╛рждрж╛ржбрж╝рж┐ ржШрзБржорж╛ржУ рж╕ржХрж╛рж▓рзЗ рждрж╛ржбрж╝рж╛рждрж╛ржбрж╝рж┐ ржЙржарждрзЗ рж╣ржмрзЗ"
}

def on_plugin_load(core):
    print("тП░ Scheduler Plugin Loaded")
    start_scheduler()
    return {"scheduled_hours": list(schedule_messages.keys())}

def start_scheduler():
    """рж╢рж┐ржбрж┐ржЙрж▓рж╛рж░ рж╢рзБрж░рзБ"""
    import threading
    
    def scheduler_loop():
        last_hour = -1
        
        while True:
            current_hour = datetime.now().hour
            
            if current_hour in schedule_messages and current_hour != last_hour:
                message = schedule_messages[current_hour]
                print(f"ЁЯУв Scheduled: {message}")
                
                # ржЗржнрзЗржирзНржЯ ржмрзНрж░ржбржХрж╛рж╕рзНржЯ
                if hasattr(core, 'broadcast_event'):
                    core.broadcast_event("scheduled_message", {
                        "hour": current_hour,
                        "message": message,
                        "time": datetime.now().strftime("%H:%M")
                    })
                
                last_hour = current_hour
            
            time.sleep(60)  # ржкрзНрж░рждрж┐ ржорж┐ржирж┐ржЯрзЗ ржЪрзЗржХ
    
    threading.Thread(target=scheduler_loop, daemon=True).start()
    print("тЬЕ Scheduler started")

def handle_event(event_name, data=None):
    if event_name == "scheduled_message":
        hour = data.get('hour')
        message = data.get('message')
        
        # ржЗржЙржЬрж╛рж░ржжрзЗрж░ ржХрж╛ржЫрзЗ ржкрж╛ржарж╛ржирзЛрж░ рж▓ржЬрж┐ржХ
        user_count = len(core._users)
        
        return {
            "scheduled": True,
            "hour": hour,
            "message": message,
            "target_users": user_count
        }
    
    return None